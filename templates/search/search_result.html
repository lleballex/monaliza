{% extends 'wrapper.html' %}
{% load it_articles_tags %}

{% block top %}

	<div class="top_intro">Результаты поиска ({% if articles %}{{articles.count}}{% elif questions %}{{questions.count}}{% elif users %}{{users.count}}{% else %}0{% endif %})</div>

{% endblock %}

{% block staticfiles %}

	<script>
		function like(id) {
			{% if not request.user.is_authenticated %}
				alert('Для того, чтобы ставить лайки, необходимо авторизоваться');
			{% else %}
			$.ajax({
				type: 'get',
				url: "{% url 'it_articles:like_article' %}",
				data: {
					'id': id,
				},	
				dataType: 'text',
				success: function(data) {
					$('#like-' + id).toggleClass('is_liked')
					if(data == 'EXIST') {
						$('#like-' + id + ' .fa').attr('class', 'fa fa-thumbs-o-up');
						$('#like-' + id + ' span').text(Number($('#like-' + id + ' span').text()) - 1);
					} else if(data = 'DOES_NOT_EXIST') {
						$('#like-' + id + ' .fa').attr('class', 'fa fa-thumbs-up');
						$('#like-' + id + ' span').text(Number($('#like-' + id + ' span').text()) + 1);
					}
				},
			});
			{% endif %}
		}
	</script>

{% endblock %}

{% block content %}

	<style>
		.search-filters ul {
			list-style: none;
  			padding: 0;
  			margin: 0;
  			display: flex;
		}

		.search-filters li {
  			width: 100%;
  			text-align: center;
		}

		.search-filters li a {
  			display: block;
  			padding: 20px;
  			color: #34495e;
  			border-bottom-width: 1px;
  			border-bottom-color: #bbb;
  			border-bottom-style: solid;
  			transition: .2s all;
  			font-weight: 600;
  			text-decoration: none;
		}

		.search-filters li:hover a {
			color: #8e44ad;
			cursor: pointer;
		}

		.search-filters .active a {
			color: #8e44ad;
			border-bottom-color: #8e44ad;
			border-bottom-width: 3px;
		}

		.search-sort {
			display: flex;
			text-align: center;
			display: flex;
			flex-direction: column;
			margin-top: 10px;
		}

		.search-sort ul {
			list-style: none;
			padding: 0;
			margin: 0;
			align-self: flex-end;
			display: flex;
		}

		.search-sort li {
			border: 1px solid #bbb;
			transition: .2s all;
		}

		.search-sort .active {
			border: 2px solid #8e44ad;
		}

		#search-sort-btn-views {
			border-top-left-radius: 4px;
			border-bottom-left-radius: 4px;
		}

		#search-sort-btn-time {
			border-top-right-radius: 4px;
			border-bottom-right-radius: 4px;
		}

		.search-sort li a {
			display: block;
			padding: 10px 20px;
			color: #34495e;
			text-decoration: none;
		}

		.search-sort li:hover a {
			color: #8e44ad;
		}

		.search-sort .active a {
			color: #8e44ad;
		}
	</style>

	<div class="search-filters">
		<ul>
			<li class="{% if request.GET.model == 'post' %}active{% endif %}"><a href="{% url 'search:search' %}?model=post&text={{request.GET.text}}&sort={{request.GET.sort}}">Посты</a></li>
			<li class="{% if request.GET.model == 'question' %}active{% endif %}"><a href="{% url 'search:search' %}?model=question&text={{request.GET.text}}&sort={{request.GET.sort}}">Вопросы</a></li>
			<li class="{% if request.GET.model == 'user' %}active{% endif %}"><a href="{% url 'search:search' %}?model=user&text={{request.GET.text}}&sort={{request.GET.sort}}">Пользователи</a></li>
		</ul>
	</div>

	<div class="content-container">
		{% if articles or questions %}
		<div class="search-sort">
			<ul>
				<li class="{% if request.GET.sort == 'views' or request.GET.sort == '' %}active{% endif %}" id="search-sort-btn-views"><a href="{% url 'search:search' %}?model={{request.GET.model}}&text={{request.GET.text}}&sort=views">по просмотрам</a></li>
				<li class="{% if request.GET.sort == 'likes' or request.GET.sort == '' %}active{% endif %}"><a href="{% url 'search:search' %}?model={{request.GET.model}}&text={{request.GET.text}}&sort=likes">по лайкам</a></li>
				<li id="search-sort-btn-time" class="{% if request.GET.sort == 'time' %}active{% endif %}"><a href="{% url 'search:search' %}?model={{request.GET.model}}&text={{request.GET.text}}&sort=time">по времени</a></li>
			</ul>
		</div>
		{% endif %}
		{% if articles %}
		<div class="articles-container">
			<ul>
			{% for article in articles %}
				{% if not request.GET.language or article.language == request.GET.language %}
				<li class="article">
					<div class="article-user">
						{% load static %}
						<img src="{% static 'account/images/user_2.png' %}" alt="" class="user-img"><a href="{% url 'search:user_page' article.user.username %}" class="user-a">{{article.user.username}} </a>
						 - {{article.date|date:'d'}} of {{article.date|date:'F'}} at {{article.date|date:'G:m'}}
					</div>
					<div class="article-title">
						<a href="{% url 'it_articles:detail' article.id %}">{{article.title}}</a>
					</div>
					<div class="article-text">
						{% with article.text|safe as text  %}
							{{text|truncatechars:'900'}}
						{% endwith %}
					</div>
					<div class="article-bottom">
						<a href="{% url 'it_articles:detail' article.id %}" class="btn-read-more">Читать далее</a>
						<ul class="article-info">
							<li class="first-li like-article {% is_liked request.user article %}" id="like-{{article.id}}" onclick="like({{article.id}})">
								<i class="fa {% is_liked_fa request.user article %}"></i><span>{{article.likes}}</span>
							</li>
							<li><i class="fa fa-eye"></i>   {{article.views}}
							</li>
						</ul>
					</div>
				</li>
				{% endif %}
			{% endfor %}
			</ul>
		</div>
	{% elif users %}
		{% for user in users %}
			<a href="{% url 'search:user_page' user.username %}">{{user.username}}</a> <br>
		{% endfor %}
	{% else %}
		<div class="information">Поиск по запросу "{{request.GET.text}}" не дал результатов</div>
	{% endif %}

	</div>

{% endblock %}