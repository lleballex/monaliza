{% extends 'wrapper.html' %}
{% load it_articles_tags %}

{% block top_title %}

	IT articles

{% endblock %}

{% block staticfiles %}

	<script>
		function like(id) {
			{% if not request.user.is_authenticated %}
				alert('Для того, чтобы ставить лайки, необходимо авторизоваться');
			{% else %}
			$.ajax({
				type: 'get',
				url: "{% url 'it_articles:like_article' %}",
				data: {
					'id': id,
				},	
				dataType: 'text',
				success: function(data) {
					$('#like-' + id).toggleClass('is_liked')
					if(data == 'EXIST') {
						$('#like-' + id + ' .fa').attr('class', 'fa fa-thumbs-o-up');
						$('#like-' + id + ' span').text(Number($('#like-' + id + ' span').text()) - 1);
					} else if(data = 'DOES_NOT_EXIST') {
						$('#like-' + id + ' .fa').attr('class', 'fa fa-thumbs-up');
						$('#like-' + id + ' span').text(Number($('#like-' + id + ' span').text()) + 1);
					}
				},
			});
			{% endif %}
		}
	</script>

{% endblock %}

{% block content %}

	<div class="content-container">
	<div class="articles new">
		<div class="articles-container">
			<ul>
			{% for article in articles %}
				{% if not request.GET.language or article.language == request.GET.language %}
				<li class="article">
					<div class="article-user">
						{% load static %}
						<img src="{% static 'account/images/user_2.png' %}" alt="" class="user-img"><a href="{% url 'account:profile' %}" class="user-a">{{article.user.username}} </a>
						 - {{article.date|date:'d'}} of {{article.date|date:'F'}} at {{article.date|date:'G:m'}}
					</div>
					<div class="article-title">
						<a href="{% url 'it_articles:detail' article.id %}">{{article.title}}</a>
					</div>
					<div class="article-text">
						{% with article.text|safe as text  %}
							{{text|truncatechars:'900'}}
						{% endwith %}
					</div>
					<div class="article-bottom">
						<a href="{% url 'it_articles:detail' article.id %}" class="btn-read-more">Читать далее</a>
						<ul class="article-info">
							<li class="first-li like-article {% is_liked request.user article %}" id="like-{{article.id}}" onclick="like({{article.id}})">
								<i class="fa {% is_liked_fa request.user article %}"></i><span>{{article.likes}}</span>
							</li>
							<li><i class="fa fa-eye"></i>   {{article.views}}
							</li>
						</ul>
					</div>
				</li>
					
				{% endif %}
			{% endfor %}
			</ul>
		</div>
	</div>
	</div>

{% endblock %}